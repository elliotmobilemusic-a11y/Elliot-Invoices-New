<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elliot Wardill Invoice Generator</title>
    <link rel="icon" type="image/png" href="i-favicon.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @media print { .no-print { display:none!important;} }
        body { font-family:Inter, sans-serif; background:#f7f9fb; }
        .invoice-container{max-width:800px;margin:2rem auto;background:white;border-radius:12px;padding:2.5rem;}
    </style>
</head>
<body>

<div class="invoice-container" id="invoice-document">
    <header class="flex justify-between items-center pb-6 border-b border-indigo-200">
        <div>
            <h1 class="text-3xl font-extrabold text-indigo-700">INVOICE</h1>
            <span id="invoice-date" class="text-sm text-gray-500"></span>
        </div>
        <div class="text-right text-sm text-gray-700">
            Elliot Wardill Mobile Music Lessons<br>Pudsey, UK<br>Email: elliotmobilemusic@gmail.com<br>Phone: 07368 975144
        </div>
    </header>

    <section class="py-6 border-b grid grid-cols-2 gap-4 text-sm">
        <div>
            <h3 class="font-semibold mb-2">BILL TO:</h3>
            <input id="client-name" class="w-full p-2 border rounded mb-1" placeholder="Client Name">
            <input id="client-address" class="w-full p-2 border rounded" placeholder="Address, Postcode">
        </div>
        <div class="text-right">
            <h3 class="font-semibold mb-2">INVOICE NO:</h3>
            <input id="invoice-number" class="w-32 p-2 border rounded text-right">
            <p class="mt-3">DUE DATE: <input id="due-date" type="date" class="border rounded p-1"></p>
        </div>
    </section>

    <section class="mt-8">
        <table class="min-w-full divide-y">
            <thead class="bg-indigo-50 text-xs text-gray-600 uppercase">
                <tr>
                    <th class="px-6 py-3 text-left">Description</th>
                    <th class="px-6 py-3 text-right">Qty</th>
                    <th class="px-6 py-3 text-right">Unit (£)</th>
                    <th class="px-6 py-3 text-right">Amount (£)</th>
                </tr>
            </thead>
            <tbody id="item-list"></tbody>
        </table>

        <div class="no-print mt-4 relative">
            <button onclick="toggleAddMenu()" class="px-4 py-2 bg-indigo-500 text-white rounded">Add Lesson ▼</button>

            <div id="add-menu" class="hidden absolute mt-2 w-64 bg-white shadow p-3 rounded z-10">
                <button onclick="addItem()" class="w-full text-left px-3 py-2 hover:bg-gray-100">➕ Add Single Lesson</button>
                <hr class="my-2">
                <div class="text-sm">
                    <label class="font-semibold">Block of Lessons</label>
                    <div class="grid grid-cols-2 gap-2 mt-2">
                        <div><label class="text-xs">Start Date</label><input id="block-start-date" type="date" class="w-full p-1 border rounded" onchange="updateBlockPreview()"></div>
                        <div><label class="text-xs">Start Time</label><input id="block-start-time" type="time" class="w-full p-1 border rounded" onchange="updateBlockPreview()"></div>
                        <div><label class="text-xs">Weeks</label><input id="block-weeks" type="number" value="4" min="1" class="w-full p-1 border rounded" onchange="updateBlockPreview()"></div>
                        <div><label class="text-xs">Lesson Type</label><select id="block-lesson-type" class="w-full p-1 border rounded"></select></div>
                    </div>
                    <div class="mt-2 text-xs">Last lesson date: <span id="block-end-date">—</span></div>
                    <div class="mt-3 flex justify-between">
                        <button onclick="generateBlock()" class="px-3 py-1 bg-indigo-500 text-white rounded">Create</button>
                        <button onclick="hideAddMenu()" class="px-3 py-1 bg-gray-200 rounded">Cancel</button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="mt-8 text-right">
        <div>Subtotal: <span id="subtotal">£0.00</span></div>
        <div class="mt-2">Travel Fee £ <input id="travel-fee" type="number" value="0.00" class="w-20 p-1 border rounded" oninput="calculateTotal()"></div>
        <div class="mt-4 text-xl font-bold">GRAND TOTAL: <span id="grand-total">£0.00</span></div>
    </section>

    <section class="mt-8 grid grid-cols-2 gap-6 text-sm">
        <div><h3 class="font-semibold mb-2">NOTES:</h3><textarea id="invoice-notes" class="w-full p-2 border rounded" rows="3"></textarea></div>
        <div><h3 class="font-semibold mb-2">PAYMENT DETAILS:</h3>Account Name: Elliot Wardill<br>Sort Code: 56-00-36<br>Account No: 40013987</div>
    </section>
</div>

<div class="no-print text-center py-6">
    <button onclick="setDynamicFilename(); window.print()" class="px-8 py-3 bg-indigo-700 text-white rounded">Print / Save as PDF</button>
</div>

<script>
const LESSON_OPTIONS = {
    "Standard Lesson (30 Mins)": 15,
    "Standard Lesson (60 Mins)": 30,
    "Standard Lesson (120 Mins)": 50,
    "Introductory Lesson": 10,
    "Free Taster Session": 0,
    "Cancellation Fee (24 Hour Policy)": 0,
    "Custom Item": 0
};

function populateBlockLessonTypes(){
    const s=document.getElementById('block-lesson-type'); s.innerHTML='';
    Object.keys(LESSON_OPTIONS).forEach(n=>{let o=document.createElement('option');o.value=n;o.textContent=n;s.appendChild(o);});
}

function createLessonSelect(def){
    let h=`<select onchange="updatePrice(this)" class='lesson-select w-full p-1 border rounded text-sm'><option disabled>Select Lesson</option>`;
    for(const[n,p]of Object.entries(LESSON_OPTIONS)) h+=`<option value='${n}' data-price='${p}' ${n===def?'selected':''}>${n}</option>`;
    return h+"</select>";
}

function addItem(def="Standard Lesson (60 Mins)",date='',time=''){
    const list=document.getElementById('item-list');
    const row=document.createElement('tr');
    row.className='item-row';
    const price=LESSON_OPTIONS[def]||0;
    row.innerHTML=`<td class='px-6 py-4'>${createLessonSelect(def)}<div class='mt-2 text-xs'><input type='date' class='lesson-date p-1 border rounded' value='${date}'> <input type='time' class='lesson-time p-1 border rounded' value='${time}'></div></td>
    <td class='px-6 py-4 text-right'><input type='number' value='1' min='1' class='item-qty w-16 p-1 border-b text-right' oninput='calculateTotal()'></td>
    <td class='px-6 py-4 text-right'><input type='number' value='${price.toFixed(2)}' class='item-price w-20 p-1 border-b text-right' oninput='calculateTotal()'></td>
    <td class='px-6 py-4 text-right total-amount'>0.00</td>
    <td class='no-print px-2'><button onclick='removeItem(this)' class='text-red-500'>✕</button></td>`;
    list.append
