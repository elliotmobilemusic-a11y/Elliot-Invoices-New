<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elliot Wardill Invoice Generator</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for printing */
        @media print {
            body {
                background: white;
                font-size: 10pt;
            }
            /* Hide controls when printing */
            .no-print {
                display: none !important;
            }
            .invoice-container {
                box-shadow: none !important;
                border: none !important;
                margin: 0;
                padding: 0;
            }
            /* Ensure text is black for clarity */
            .text-gray-700, .text-gray-500 {
                color: #000 !important;
            }
        }

        /* Inter font for a clean, modern look */
        body {
            font-family: "Inter", sans-serif;
        }

        /* Style for the Print button */
        .print-button {
            transition: all 0.15s ease-in-out;
        }
        .print-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
        }
        /* Custom focus state */
        .print-button:focus {
            outline: 2px solid #10B981;
            outline-offset: 2px;
        }
    </style>
    <script>
        // Data structure for quick price lookup (from your policy)
        const RATES = {
            '30': 15.00,
            '60': 30.00,
            '90': 50.00,
            'intro': 10.00
        };

        // Data structure for travel fees (from your policy)
        const TRAVEL_FEES = {
            '0': 0.00,
            '5': 5.00, // 5 Miles +
            '10': 10.00, // 10 Miles +
            '15': 20.00 // 15 Miles + (using the £20 minimum)
        };

        // Bank details from Step 6 (Finalized)
        const BANK_DETAILS = {
            name: "Elliot Wardill",
            sortCode: "56-00-36",
            accountNumber: "40013987",
            reference: "[CLIENT SURNAME] - LESSON"
        };


        // --- Core Invoice Generation Logic ---

        function calculateTotal() {
            const lessonType = document.getElementById('lessonType').value;
            const lessonCount = parseInt(document.getElementById('lessonCount').value) || 0;
            const travelDistance = document.getElementById('travelDistance').value;
            const customFee = parseFloat(document.getElementById('customFee').value) || 0;
            
            // Get base lesson price
            const baseRate = RATES[lessonType] || 0;
            
            // Calculate lesson subtotal
            let lessonSubtotal = baseRate * lessonCount;

            // Get travel fee
            const travelFee = TRAVEL_FEES[travelDistance] || 0;

            // Calculate grand total
            const grandTotal = lessonSubtotal + travelFee + customFee;

            // Update display fields
            document.getElementById('lessonSubtotal').innerText = '£' + lessonSubtotal.toFixed(2);
            document.getElementById('travelFeeDisplay').innerText = '£' + travelFee.toFixed(2);
            document.getElementById('customFeeDisplay').innerText = '£' + customFee.toFixed(2);
            document.getElementById('grandTotalDisplay').innerText = '£' + grandTotal.toFixed(2);
            
            // Update quantity display
            const lessonTypeText = document.querySelector(`#lessonType option[value="${lessonType}"]`).text;
            document.getElementById('lessonDescription').innerHTML = `${lessonTypeText} x ${lessonCount}`;
            document.getElementById('invoiceQuantity').innerText = lessonCount;
        }

        function generateInvoice() {
            // 1. Update static fields
            document.getElementById('invoiceDate').innerText = new Date().toLocaleDateString('en-GB', { 
                day: '2-digit', 
                month: 'long', 
                year: 'numeric' 
            });
            document.getElementById('invoiceNumber').innerText = Math.floor(Math.random() * 9000) + 1000;
            document.getElementById('lessonDescription').innerText = document.querySelector(`#lessonType option[value="${document.getElementById('lessonType').value}"]`).text;
            
            // 2. Client Details (Sanitize input for display)
            const clientName = document.getElementById('clientName').value.trim() || 'Client Name';
            document.getElementById('invoiceClientName').innerText = clientName;

            // 3. Populate Bank Details
            document.getElementById('bankName').innerText = BANK_DETAILS.name;
            document.getElementById('bankSortCode').innerText = BANK_DETAILS.sortCode;
            document.getElementById('bankAccountNumber').innerText = BANK_DETAILS.accountNumber;
            document.getElementById('bankReference').innerText = BANK_DETAILS.reference.replace('[CLIENT SURNAME]', clientName.split(' ').pop() || 'LESSON');
            
            // 4. Calculate final totals (redundant but safe)
            calculateTotal();

            // 5. Trigger Print Dialog
            window.print();
        }

        // Initialize bank details on load
        window.onload = function() {
            calculateTotal(); // Initial calculation
            document.querySelectorAll('input, select').forEach(element => {
                element.addEventListener('input', calculateTotal);
            });
        };
    </script>
</head>
<body class="bg-gray-100 p-4 sm:p-8 min-h-screen">
    <div class="max-w-4xl mx-auto">
        
        <!-- Controls and Print Button (No-Print Section) -->
        <div class="no-print bg-white p-6 rounded-xl shadow-lg mb-8">
            <h2 class="text-xl font-bold text-gray-800 mb-4">Invoice Controls</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                <!-- Client Name -->
                <div>
                    <label for="clientName" class="block text-sm font-medium text-gray-700">Client Name</label>
                    <input type="text" id="clientName" value="Mrs. Smith" placeholder="Client Name" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2 border">
                </div>
                
                <!-- Lesson Type -->
                <div>
                    <label for="lessonType" class="block text-sm font-medium text-gray-700">Lesson Type</label>
                    <select id="lessonType" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2 border">
                        <option value="60">60 Min Lesson (£30)</option>
                        <option value="30">30 Min Lesson (£15)</option>
                        <option value="90">90 Min Lesson (£50)</option>
                        <option value="intro">Introductory Lesson (£10)</option>
                    </select>
                </div>

                <!-- Lesson Count -->
                <div>
                    <label for="lessonCount" class="block text-sm font-medium text-gray-700">Lessons Billed</label>
                    <input type="number" id="lessonCount" value="1" min="1" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2 border">
                </div>
                
                <!-- Travel Distance -->
                <div>
                    <label for="travelDistance" class="block text-sm font-medium text-gray-700">Travel Fee (Miles+)</label>
                    <select id="travelDistance" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2 border">
                        <option value="0">0 Miles (No Fee)</option>
                        <option value="5">5 Miles + (£5)</option>
                        <option value="10">10 Miles + (£10)</option>
                        <option value="15">15 Miles + (£20)</option>
                    </select>
                </div>
                
                <!-- Custom Fee -->
                <div class="md:col-span-2 lg:col-span-1">
                    <label for="customFee" class="block text-sm font-medium text-gray-700">Custom Fee (e.g., resources)</label>
                    <input type="number" id="customFee" value="0.00" min="0" step="0.01" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2 border">
                </div>
            </div>
            
            <div class="flex justify-end">
                <button onclick="generateInvoice()" class="print-button px-6 py-3 bg-indigo-600 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-700 transition duration-150 ease-in-out">
                    Generate & Print/Save PDF
                </button>
            </div>
        </div>

        <!-- INVOICE SECTION (Printable) -->
        <div id="invoice" class="invoice-container bg-white p-6 sm:p-10 rounded-xl shadow-2xl border border-gray-200">
            
            <!-- Header -->
            <header class="flex justify-between items-start border-b pb-4 mb-6">
                <div>
                    <h1 class="text-3xl font-extrabold text-indigo-700">INVOICE</h1>
                    <p class="text-sm text-gray-500 mt-1">
                        Invoice #<span id="invoiceNumber">1001</span><br>
                        Date: <span id="invoiceDate">17 October 2025</span>
                    </p>
                </div>
                <div class="text-right">
                    <h2 class="text-xl font-semibold text-gray-800">Elliot Wardill Mobile Music</h2>
                    <p class="text-sm text-gray-700">
                        Pudsey, Leeds, UK<br>
                        Phone: 07368 975144<br>
                        Email: elliotmobilemusic@gmail.com
                    </p>
                </div>
            </header>

            <!-- Bill To & Summary -->
            <section class="flex justify-between items-start mb-8">
                <div>
                    <h3 class="text-md font-bold text-gray-700 mb-1">Billed To:</h3>
                    <p id="invoiceClientName" class="text-lg font-medium text-gray-800">Client Name</p>
                    <p class="text-sm text-gray-500">For services rendered by Elliot Wardill.</p>
                </div>
                <div class="text-right">
                    <h3 class="text-md font-bold text-gray-700 mb-1">Invoice Total:</h3>
                    <p id="grandTotalDisplay" class="text-3xl font-extrabold text-indigo-600">£30.00</p>
                    <p class="text-sm text-gray-500 mt-1">Due Upon Receipt</p>
                </div>
            </section>

            <!-- Line Items Table -->
            <section class="mb-8">
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead>
                            <tr class="bg-gray-50">
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider rounded-tl-lg">Description</th>
                                <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Qty</th>
                                <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Rate</th>
                                <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider rounded-tr-lg">Amount</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200 text-gray-700">
                            <!-- Lesson Item -->
                            <tr>
                                <td class="px-4 py-3 whitespace-nowrap">
                                    <span id="lessonDescription">60 Min Lesson x 1</span>
                                </td>
                                <td id="invoiceQuantity" class="px-4 py-3 whitespace-nowrap text-right">1</td>
                                <td class="px-4 py-3 whitespace-nowrap text-right">£30.00</td>
                                <td id="lessonSubtotal" class="px-4 py-3 whitespace-nowrap text-right font-medium">£30.00</td>
                            </tr>
                            <!-- Travel Item -->
                            <tr>
                                <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">Travel Fee (as per policy)</td>
                                <td class="px-4 py-3 whitespace-nowrap text-right">1</td>
                                <td class="px-4 py-3 whitespace-nowrap text-right"></td>
                                <td id="travelFeeDisplay" class="px-4 py-3 whitespace-nowrap text-right">£0.00</td>
                            </tr>
                            <!-- Custom Item -->
                            <tr>
                                <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">Custom Fee / Resources</td>
                                <td class="px-4 py-3 whitespace-nowrap text-right">1</td>
                                <td class="px-4 py-3 whitespace-nowrap text-right"></td>
                                <td id="customFeeDisplay" class="px-4 py-3 whitespace-nowrap text-right">£0.00</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Totals Summary -->
                <div class="flex justify-end mt-4">
                    <div class="w-full sm:w-1/2 lg:w-1/3">
                        <div class="flex justify-between py-2 border-t border-gray-200">
                            <span class="text-sm font-medium text-gray-600">Subtotal:</span>
                            <span id="totalBeforeDiscount" class="text-sm font-medium text-gray-600">£30.00</span>
                        </div>
                        <div class="flex justify-between pt-3 pb-2 border-t border-indigo-200 bg-indigo-50 rounded-b-lg">
                            <span class="text-xl font-bold text-indigo-700 px-4">TOTAL DUE (GBP)</span>
                            <span id="grandTotalDisplayFinal" class="text-xl font-bold text-indigo-700 px-4">£30.00</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Payment Details & Notes -->
            <section class="pt-6 border-t border-gray-200">
                <h3 class="text-lg font-bold text-gray-700 mb-3">Payment Instructions</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Bank Details -->
                    <div>
                        <p class="text-sm font-semibold text-gray-800 mb-1">Bank Transfer (BACS)</p>
                        <ul class="text-sm text-gray-700 space-y-1">
                            <li>**Account Name:** <span id="bankName">Elliot Wardill</span></li>
                            <li>**Sort Code:** <span id="bankSortCode">56-00-36</span></li>
                            <li>**Account No:** <span id="bankAccountNumber">40013987</span></li>
                        </ul>
                    </div>
                    <!-- Reference -->
                    <div>
                        <p class="text-sm font-semibold text-gray-800 mb-1">Important Reference</p>
                        <p class="text-sm text-gray-700">
                            When making payment, please use the following as the reference to ensure your payment is quickly tracked:
                        </p>
                        <p class="text-md font-extrabold text-indigo-600 mt-2">
                            Reference: <span id="bankReference">[CLIENT SURNAME] - LESSON</span>
                        </p>
                    </div>
                </div>
                
                <p class="text-sm text-gray-500 mt-6 pt-4 border-t text-center">
                    Thank you for your business. For full policy details, please visit your welcome email or the policies page on my website.
                </p>
            </section>

        </div>
    </div>
</body>
</html>
