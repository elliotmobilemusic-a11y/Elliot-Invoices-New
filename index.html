<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elliot Wardill Invoice Generator</title>
    <link rel="icon" type="image/png" href="i-favicon.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Print styles */
        @media print {
            body { background: white; font-size: 10pt; }
            .no-print { display: none !important; }
            .invoice-container { box-shadow: none !important; border: none !important; margin: 0; padding: 0; }
            .text-gray-700, .text-gray-900 { color: #000 !important; }
            /* Ensure block end is highlighted on print */
            .block-end-print { font-weight: 700; color: #3730A3 !important; }
        }
        body { font-family: 'Inter', sans-serif; background-color: #f7f9fb; }
        .invoice-container { max-width: 800px; margin: 2rem auto; background: white; border-radius: 12px; box-shadow: 0 10px 25px -5px rgba(0,0,0,0.1); padding: 2.5rem; border: 1px solid #e5e7eb; }
        .block-end { font-weight: 700; color: #3730A3; }
        /* Print-only summary area (hidden on screen) */
        .print-only { display: none; }
        @media print { .print-only { display: block !important; } .screen-only { display: none !important; } }
    </style>
</head>
<body>

<div class="invoice-container" id="invoice-document">
    <header class="flex justify-between items-center pb-6 border-b border-indigo-200">
        <div>
            <h1 class="text-3xl font-extrabold text-indigo-700">INVOICE</h1>
            <div class="mt-2 flex items-center space-x-2 text-sm text-gray-500">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-indigo-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                <span id="invoice-date">October 18, 2025</span>
            </div>
        </div>
        <div class="text-right">
            <h2 class="text-xl font-semibold text-gray-900">Elliot Wardill Mobile Music Lessons</h2>
            <p class="text-sm text-gray-600">Pudsey, UK</p>
            <p class="text-sm text-gray-600">Email: elliotmobilemusic@gmail.com</p>
            <p class="text-sm text-gray-600">Phone: 07368 975144</p>
        </div>
    </header>

    <section class="py-6 border-b border-gray-100 grid grid-cols-2 gap-4 text-sm">
        <div>
            <h3 class="font-semibold text-gray-700 mb-2">BILL TO:</h3>
            <input id="client-name" type="text" placeholder="Client Full Name" class="w-full p-2 border border-gray-300 rounded-lg mb-1">
            <input id="client-address" type="text" placeholder="Address, Postcode" class="w-full p-2 border border-gray-300 rounded-lg">
        </div>
        <div class="text-right">
            <h3 class="font-semibold text-gray-700 mb-2">INVOICE DETAILS:</h3>
            <input id="invoice-number" type="text" value="EW-" class="w-40 p-2 border border-gray-300 rounded-lg text-right mb-2">
            <div class="text-sm text-gray-500">DUE DATE: <input id="due-date" type="date" class="border border-gray-300 rounded-lg p-1"></div>
            <div class="text-sm text-gray-500 mt-1">LESSON DATE: <input id="lesson-date" type="date" class="border border-gray-300 rounded-lg p-1"></div>
            <div class="text-sm text-gray-500 mt-1">LESSON TIME: <input id="lesson-time" type="time" class="border border-gray-300 rounded-lg p-1"></div>
        </div>
    </section>

    <section class="mt-8">
        <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-indigo-50">
                <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Description</th>
                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Qty</th>
                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Unit Price (£)</th>
                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Amount (£)</th>
                </tr>
            </thead>
            <tbody id="item-list"></tbody>
        </table>
        <div class="no-print mt-4 flex justify-between">
            <button onclick="addItem()" class="px-4 py-2 bg-indigo-500 text-white rounded-lg hover:bg-indigo-600">Add Lesson</button>
        </div>
    </section>

    <section class="mt-8 flex justify-end">
        <div class="w-full md:w-1/2 space-y-3">
            <div class="flex justify-between text-sm font-medium text-gray-700">
                <span>Subtotal:</span>
                <span id="subtotal">£0.00</span>
            </div>
            <div class="flex justify-between items-center text-sm font-medium text-gray-700 border-t pt-2">
                <label for="travel-fee">Travel Fee (Distance)</label>
                <select id="travel-fee" onchange="calculateTotal()" class="border border-gray-300 rounded-lg p-1">
                    <option value="0">Within 5 miles – £0</option>
                    <option value="5">5 miles+ – £5</option>
                    <option value="10">10 miles+ – £10</option>
                    <option value="20">15 miles+ – £20</option>
                </select>
            </div>
            <div class="flex justify-between items-center text-lg font-bold text-gray-800 border-t-4 border-indigo-500 pt-4">
                <span>GRAND TOTAL:</span>
                <span id="grand-total">£0.00</span>
            </div>
        </div>
    </section>

    <!-- Block booking + print summary -->
    <section class="mt-10 pt-6 border-t border-gray-200 grid md:grid-cols-2 gap-8 text-sm screen-only">
        <div>
            <h3 class="font-semibold text-gray-700 mb-2">BLOCK BOOKING:</h3>
            <label class="block mb-1 text-gray-600">Start Date</label>
            <input type="date" id="block-start" class="w-full p-2 border border-gray-300 rounded-lg mb-2" oninput="updateBlockEnd()">
            <label class="block mb-1 text-gray-600">Number of Weeks</label>
            <input type="number" id="block-weeks" min="1" class="w-full p-2 border border-gray-300 rounded-lg mb-2" oninput="updateBlockEnd()">
            <p class="mt-2 text-gray-700">Block End Date: <span id="block-end" class="block-end">–</span></p>
            <input type="text" id="installment-note" placeholder="e.g., Payment 1 of 3" class="w-full p-2 border border-gray-300 rounded-lg mt-2">
        </div>
        <div>
            <h3 class="font-semibold text-gray-700 mb-2">NOTES:</h3>
            <textarea id="invoice-notes" rows="4" class="w-full p-2 border border-gray-300 rounded-lg" placeholder="Additional details or notes"></textarea>
        </div>
    </section>

    <!-- Print-only block summary (hidden on screen, shown on print) -->
    <div class="print-only mt-6 border-t border-gray-200 pt-4">
        <p class="text-sm text-gray-700">Block Booking: <span id="print-block-info" class="block-end-print">Not selected</span></p>
    </div>

    <section class="mt-10 border-t border-gray-200 pt-6 text-sm">
        <h3 class="font-semibold text-gray-700 mb-2">PAYMENT DETAILS:</h3>
        <p>Preferred: Bank Transfer</p>
        <p>Account Name: Elliot Wardill</p>
        <p>Sort Code: 56-00-36</p>
        <p>Account No: 40013987</p>
    </section>
</div>

<div class="no-print text-center py-6">
    <button id="print-btn" onclick="triggerPrint()" class="px-8 py-3 bg-indigo-700 text-white font-bold rounded-lg hover:bg-indigo-800">Print / Save as PDF</button>
</div>

<script>
    // Lesson options
    const LESSON_OPTIONS = {
        'Standard Lesson (30 Mins)': 15.00,
        'Standard Lesson (60 Mins)': 30.00,
        'Standard Lesson (120 Mins)': 50.00,
        'Introductory Lesson': 10.00,
        'Free Taster Session': 0.00
    };

    function addItem(defaultOption='Standard Lesson (60 Mins)') {
        const list = document.getElementById('item-list');
        const newRow = document.createElement('tr');
        const defaultPrice = LESSON_OPTIONS[defaultOption];
        newRow.className = 'item-row';
        newRow.innerHTML = `
            <td class="px-6 py-4">
                <select onchange="updatePrice(this)" class="lesson-select w-full p-1 border border-gray-300 rounded-lg">
                    ${Object.entries(LESSON_OPTIONS).map(([name,price])=>`<option value="${price}">${name}</option>`).join('')}
                </select>
            </td>
            <td class="px-6 py-4 text-right"><input type="number" value="1" min="1" class="item-qty w-16 p-1 text-right border-b border-gray-300" oninput="calculateTotal()"></td>
            <td class="px-6 py-4 text-right"><input type="number" value="${defaultPrice}" min="0" step="0.01" class="item-price w-20 p-1 text-right border-b border-gray-300" oninput="calculateTotal()"></td>
            <td class="px-6 py-4 text-right total-amount">${defaultPrice.toFixed(2)}</td>
            <td class="px-2 py-4 no-print"><button onclick="removeItem(this)" class="text-red-500">✕</button></td>`;
        list.appendChild(newRow);
        calculateTotal();
    }

    function updatePrice(select) {
        const row = select.closest('tr');
        const price = parseFloat(select.value);
        row.querySelector('.item-price').value = price.toFixed(2);
        calculateTotal();
    }

    function removeItem(btn) {
        btn.closest('tr').remove();
        calculateTotal();
    }

    function calculateTotal() {
        let subtotal = 0;
        document.querySelectorAll('.item-row').forEach(row => {
            const qty = parseFloat(row.querySelector('.item-qty').value) || 0;
            const price = parseFloat(row.querySelector('.item-price').value) || 0;
            const total = qty * price;
            row.querySelector('.total-amount').textContent = total.toFixed(2);
            subtotal += total;
        });
        const travelFee = parseFloat(document.getElementById('travel-fee').value) || 0;
        const grand = subtotal + travelFee;
        document.getElementById('subtotal').textContent = '£' + subtotal.toFixed(2);
        document.getElementById('grand-total').textContent = '£' + grand.toFixed(2);
    }

    function updateBlockEnd() {
        const start = document.getElementById('block-start').value;
        const weeks = parseInt(document.getElementById('block-weeks').value) || 0;
        if(start && weeks>0){
            const startDate = new Date(start);
            startDate.setDate(startDate.getDate() + (weeks*7));
            const formatted = startDate.toLocaleDateString('en-GB');
            document.getElementById('block-end').textContent = formatted;
            document.getElementById('block-end').classList.add('block-end');
        } else {
            document.getElementById('block-end').textContent = '–';
            document.getElementById('block-end').classList.remove('block-end');
        }
        // Keep print summary in sync
        syncPrintBlockInfo();
    }

    function syncPrintBlockInfo(){
        const start = document.getElementById('block-start').value;
        const weeks = parseInt(document.getElementById('block-weeks').value) || 0;
        const printInfo = document.getElementById('print-block-info');
        if(start && weeks>0){
            const startDate = new Date(start);
            startDate.setDate(startDate.getDate() + (weeks*7));
            const formatted = startDate.toLocaleDateString('en-GB');
            printInfo.textContent = `Ends ${formatted}`;
        } else {
            printInfo.textContent = 'Not selected';
        }
    }

    // Prepare and trigger print with smart filename
    function triggerPrint(){
        prepareForPrint();
        window.print();
        // restore title after print (onafterprint may not fire consistently in some browsers)
        setTimeout(()=>{ document.title = 'Elliot Wardill Invoice Generator'; }, 1000);
    }

    function sanitizeFilename(str){
        return str.replace(/[^a-z0-9 \-_,.()]/gi,'').trim();
    }

    function prepareForPrint(){
        // Set document title so browser's Save as PDF suggests it
        const invoiceNo = document.getElementById('invoice-number').value || 'Invoice';
        const client = document.getElementById('client-name').value || 'Client';
        let lessonDate = document.getElementById('lesson-date').value;
        if(!lessonDate){
            // fallback to invoice-date shown text
            lessonDate = new Date().toISOString().split('T')[0];
        }
        const filename = `${invoiceNo} - ${client} - ${lessonDate}`;
        document.title = sanitizeFilename(filename);

        // Sync print-only block info
        syncPrintBlockInfo();

        // If block isn't selected, ensure print shows 'Not selected' (handled by syncPrintBlockInfo)
    }

    // Bind before/after print too for better cross-browser behaviour
    window.onbeforeprint = prepareForPrint;
    window.onafterprint = function(){ document.title = 'Elliot Wardill Invoice Generator'; };

    window.onload = function(){
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('due-date').value = today;
        document.getElementById('invoice-date').textContent = new Date().toLocaleDateString('en-GB',{year:'numeric',month:'long',day:'numeric'});
        document.getElementById('invoice-number').value = 'EW-' + Math.floor(Math.random()*90000+10000);
        addItem();
        syncPrintBlockInfo();
    }
</script>
</body>
</html>
